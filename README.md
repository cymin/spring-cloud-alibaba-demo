spring cloud demo

## version
- java 1.8
- spring-boot.version 2.3.11.RELEASE
- spring-cloud-alibaba.version 2.2.5.RELEASE
- spring-cloud.version Hoxton.SR8
- mysql 5.7.22
- maven apache-maven 3.6.3
- idea 2020.1.4
- seata 1.3.0
- nginx 1.15.0
- sentinel 1.8.0


## 服务说明
如果使用nacos集群，则集群中的nacos必须要全部可用，不然spring应用会注册不到nacos服务中去。

## 分布式事务搭建步骤
1. 添加依赖
```xml
<!-- seata的client端 -->
<dependency>
    <groupId>com.alibaba.cloud</groupId>
    <artifactId>spring-cloud-starter-alibaba-seata</artifactId>
</dependency>
```
2. 各微服务对应的数据库中添加`undo_log`日志表
3. 各微服务配置事务分组
```yaml
spring:
  cloud:
    alibaba:
      seata:
        # 事务分组
        tx-service-group: my_test_tx_group

```
4. 配置seata的注册中心，告诉seata client（也就是我们的微服务）怎么与seata server通讯
```yaml
seata:
  # 设置seata的注册中心,告诉seata client怎么与seata server（TC）通讯（在springboot2.1之前只能通过registry.conf文件配置，即与seata的相同的registry.conf复制到微服务的resources目录中一份）
  registry:
    type: nacos
    nacos:
      server-addr: localhost:8847 # 这就是seata server（TC）所在的nacos服务地址
      username: nacos
      password: nacos
      application: seata-server # 这就是seata server（TC）的服务名称，默认seata-server，如果未修改可以不配
      group: SEATA_GROUP # 这就是seata server（TC）所在的组，默认SEATA_GROUP，如果未修改可以不配
```
5. 需要设置seata的配置中心，可以读取到nacos中配置列表中关于client.*的配置项
```yaml
seata:
  config:
    type: nacos
    nacos:
      server-addr: localhost:8847
      username: nacos
      password: nacos
      group: SEATA_GROUP
```

## 测试
1.请求下单接口
发现临时生成undo_log表生成临时日志：
```sql
INSERT INTO `undo_log` (`id`, `branch_id`, `xid`, `context`, `rollback_info`, `log_status`, `log_created`, `log_modified`)
      VALUES
      	(1, 222474554683977728, '192.168.1.167:8091:222474491329015808', 'serializer=jackson', X'7B2240636C617373223A22696F2E73656174612E726D2E64617461736F757263652E756E646F2E4272616E6368556E646F4C6F67222C22786964223A223139322E3136382E312E3136373A383039313A323232343734343931333239303135383038222C226272616E63684964223A3232323437343535343638333937373732382C2273716C556E646F4C6F6773223A5B226A6176612E7574696C2E41727261794C697374222C5B7B2240636C617373223A22696F2E73656174612E726D2E64617461736F757263652E756E646F2E53514C556E646F4C6F67222C2273716C54797065223A22494E53455254222C227461626C654E616D65223A226F726465725F74626C222C226265666F7265496D616765223A7B2240636C617373223A22696F2E73656174612E726D2E64617461736F757263652E73716C2E7374727563742E5461626C655265636F72647324456D7074795461626C655265636F726473222C227461626C654E616D65223A226F726465725F74626C222C22726F7773223A5B226A6176612E7574696C2E41727261794C697374222C5B5D5D7D2C226166746572496D616765223A7B2240636C617373223A22696F2E73656174612E726D2E64617461736F757263652E73716C2E7374727563742E5461626C655265636F726473222C227461626C654E616D65223A226F726465725F74626C222C22726F7773223A5B226A6176612E7574696C2E41727261794C697374222C5B7B2240636C617373223A22696F2E73656174612E726D2E64617461736F757263652E73716C2E7374727563742E526F77222C226669656C6473223A5B226A6176612E7574696C2E41727261794C697374222C5B7B2240636C617373223A22696F2E73656174612E726D2E64617461736F757263652E73716C2E7374727563742E4669656C64222C226E616D65223A226964222C226B657954797065223A225052494D4152595F4B4559222C2274797065223A342C2276616C7565223A5B226A6176612E6C616E672E4C6F6E67222C325D7D2C7B2240636C617373223A22696F2E73656174612E726D2E64617461736F757263652E73716C2E7374727563742E4669656C64222C226E616D65223A2270726F647563745F6964222C226B657954797065223A224E554C4C222C2274797065223A342C2276616C7565223A397D2C7B2240636C617373223A22696F2E73656174612E726D2E64617461736F757263652E73716C2E7374727563742E4669656C64222C226E616D65223A22746F74616C5F616D6F756E74222C226B657954797065223A224E554C4C222C2274797065223A342C2276616C7565223A3130307D2C7B2240636C617373223A22696F2E73656174612E726D2E64617461736F757263652E73716C2E7374727563742E4669656C64222C226E616D65223A22737461747573222C226B657954797065223A224E554C4C222C2274797065223A342C2276616C7565223A307D5D5D7D5D5D7D7D5D5D7D', 0, '2022-01-06 13:54:27', '2022-01-06 13:54:27');

```







